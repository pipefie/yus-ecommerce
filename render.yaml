services:
  - type: web
    name: yus-ecommerce-web
    env: node
    plan: free
    buildCommand: |
      npm ci
      npx prisma generate
      npm run build
    startCommand: |
      npx prisma migrate deploy
      npm run start
    envVars:
      - key: NODE_VERSION
        value: 22
      - key: DATABASE_URL
        fromDatabase: true
        name: yus-postgres
      - key: NEXT_PUBLIC_URL
        value: https://yus-ecommerce-web.onrender.com
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: BASE_URL
        value: https://yus-ecommerce-web.onrender.com
      - key: OIDC_ISSUER
        sync: false
      - key: OIDC_CLIENT_ID
        sync: false
      - key: OIDC_CLIENT_SECRET
        sync: false
      - key: OIDC_REDIRECT_URI
        value: https://yus-ecommerce-web.onrender.com/auth/callback
      - key: OIDC_POST_LOGOUT_REDIRECT_URI
        value: https://yus-ecommerce-web.onrender.com/
      - key: OIDC_AUDIENCE
        sync: false
      - key: SESSION_SECRET
        sync: false
      - key: SESSION_TTL_HOURS
        value: "8"
      - key: PRINTFUL_API_KEY
        sync: false
      - key: PRINTFUL_STORE_ID
        sync: false
      - key: PRINTFUL_WEBHOOK_SECRET
        sync: false
      - key: DEFAULT_CURRENCY
        value: EUR
      - key: CLOUDFRONT_BASE_URL
        sync: false
      - key: ASSETS_BUCKET
        sync: false
      - key: AWS_REGION
        sync: false
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
    healthCheckPath: /

databases:
  - name: yus-postgres
    plan: free
